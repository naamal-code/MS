<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ペプチド分子量計算</title>
    <style>
        :root {
            --primary-color: #7fff00; 
            --text-color: #7fff00;
            --border-color: #4CAF50;
            --bg-color: #000;
        }

        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            width: 100%;
            max-width: 900px;
            font-weight: normal;
            margin-bottom: 40px;
            text-align: left;
        }

        /* メインのグリッドレイアウト */
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            max-width: 900px;
            width: 100%;
            margin-bottom: 30px;
        }

        /* 各カラムのスタイル */
        .column {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* セクション見出し（N末端/C末端などの区切り用） */
        .section-label {
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: white;
        }
        .section-label:first-child {
            margin-top: 0;
        }

        /* ボタンスタイル */
        button {
            background-color: #fff;
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            border-radius: 4px;
            color: var(--text-color);
        }

        button:hover {
            background-color: white;
            border-color: var(--primary-color);
        }

        button:active {
            transform: translateY(1px);
        }

        /* 選択状態のスタイル */
        button.selected {
            background-color: #e8f5e9;
            border-color: var(--primary-color);
            border-left: 5px solid var(--primary-color);
            font-weight: bold;
        }

        /* カウンターバッジ（複数回押したときの表示） */
        .count-badge {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--primary-color);
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: bold;
            display: none; /* デフォルトは非表示 */
        }

        button.selected .count-badge {
            display: inline-block;
        }

        /* アクションボタンエリア（クリア・計算） */
        .action-area {
            display: flex;
            gap: 20px;
            margin-top: auto; /* カラムの下部に配置 */
            padding-top: 20px;
        }

        .action-btn {
            flex: 1;
            text-align: center;
            border: 1px solid var(--primary-color);
            color: var(--text-color);
            padding: 15px;
        }

        .action-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* 結果表示エリア */
        .results-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            max-width: 900px;
            width: 100%;
        }

        .result-box {
            border: 1px solid var(--primary-color);
            padding: 20px;
            text-align: center;
            height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 2px;
        }

        .result-label {
            font-size: 0.9em;
            margin-bottom: 5px;
            color: white;
        }

        .result-value {
            font-size: 1.2em;
            font-weight: bold;
        }

        /* レスポンシブ対応（スマホなど） */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr 1fr; /* 2列に */
            }
            .results-container {
                grid-template-columns: 1fr; /* 1列に */
            }
            .action-area {
                grid-column: span 2;
            }
        }
    </style>
</head>
<body>

    <h1>ペプチド分子量計算</h1>

    <div class="container">
        <div class="column" id="col-terminals">
            <div class="section-label">N末端 (選択1つ)</div>
            <div id="n-term-group"></div>

            <div class="section-label">C末端 (選択1つ)</div>
            <div id="c-term-group"></div>
        </div>

        <div class="column" id="col-aa-1">
            </div>

        <div class="column" id="col-aa-2">
            </div>

        <div class="column">
            <div id="col-special">
                </div>
            
            <div class="action-area">
                <button class="action-btn" onclick="clearAll()">クリア</button>
                <button class="action-btn" onclick="calculate()">計算</button>
            </div>
        </div>
    </div>

    <div class="results-container">
        <div class="result-box">
            <span class="result-label">分子量</span>
            <span class="result-value" id="res-mw">---</span>
        </div>
        <div class="result-box">
            <span class="result-label">2+</span>
            <span class="result-value" id="res-plus2">---</span>
        </div>
        <div class="result-box">
            <span class="result-label">3+</span>
            <span class="result-value" id="res-plus3">---</span>
        </div>
    </div>

    <script>
        // --- データ定義 ---
        const aminoAcids1 = [
            { name: "Ala", val: 71.07 }, { name: "Arg", val: 156.18 },
            { name: "Asn", val: 114.1 }, { name: "Asp", val: 115.08 },
            { name: "Cys", val: 103.14 }, { name: "Gln", val: 128.13 },
            { name: "Glu", val: 129.11 }, { name: "Gly", val: 57.05 },
            { name: "His", val: 137.13 }, { name: "Ile", val: 113.15 }
        ];

        const aminoAcids2 = [
            { name: "Leu", val: 113.15 }, { name: "Lys", val: 128.17 },
            { name: "Met", val: 131.19 }, { name: "Phe", val: 147.17 },
            { name: "Pro", val: 97.11 },  { name: "Ser", val: 87.07 },
            { name: "Thr", val: 101.1 }, { name: "Trp", val: 186.21 },
            { name: "Tyr", val: 163.17 }, { name: "Val", val: 99.13 }
        ];

        const specials = [
            { name: "Hyp", val: 113.11 }, { name: "Aib", val: 85.1 },
            { name: "Phg", val: 133.15 }, { name: "Cha", val: 153.22 },
            { name: "Nal", val: 197.23 }
        ];

        const modifications = [
            { name: "H → CH3", val: 14.03 }, { name: "H → F", val: 17.99 },
            { name: "H → Cl", val: 34.44 },  { name: "H → NO2", val: 45.00 },
            { name: "H → N3", val: 41.02 }
        ];

        const nTerminals = [
            { name: "H", val: 1.01 },     { name: "Fmoc", val: 223.26 },
            { name: "Boc", val: 101.13 }, { name: "Ac", val: 43.05 }
        ];

        const cTerminals = [
            { name: "OH", val: 17.01 },   { name: "NH2", val: 16.03 }
        ];

        // --- 状態管理 ---
        // IDをキーにしてカウントや選択状態を管理
        let counts = {}; // アミノ酸、特殊、修飾用: { 'Ala': 2, 'Hyp': 1 }
        let selectedNTerm = null; // N末端は単一選択
        let selectedCTerm = null; // C末端は単一選択

        // --- 初期化 ---
        function init() {
            renderButtons("col-aa-1", aminoAcids1, "count");
            renderButtons("col-aa-2", aminoAcids2, "count");
            renderButtons("col-special", [...specials, ...modifications], "count");
            renderButtons("n-term-group", nTerminals, "radio-n");
            renderButtons("c-term-group", cTerminals, "radio-c");
        }

        // ボタン生成関数
        function renderButtons(containerId, dataList, type) {
            const container = document.getElementById(containerId);
            dataList.forEach(item => {
                const btn = document.createElement("button");
                btn.innerHTML = `${item.name} <span class="count-badge" id="badge-${cleanId(item.name)}">0</span>`;
                btn.id = `btn-${cleanId(item.name)}`;
                
                // クリックイベントの設定
                if (type === "count") {
                    // カウントアップタイプ（アミノ酸・修飾）
                    counts[item.name] = 0;
                    btn.onclick = () => {
                        counts[item.name]++;
                        updateButtonDisplay(item.name, type);
                    };
                } else if (type === "radio-n") {
                    // N末端（単一選択）
                    btn.onclick = () => {
                        // 既に選択されていたら解除、そうでなければ選択
                        if (selectedNTerm === item) {
                            selectedNTerm = null;
                        } else {
                            selectedNTerm = item;
                        }
                        updateRadioDisplay(nTerminals, selectedNTerm, "radio-n");
                    };
                } else if (type === "radio-c") {
                    // C末端（単一選択）
                    btn.onclick = () => {
                        if (selectedCTerm === item) {
                            selectedCTerm = null;
                        } else {
                            selectedCTerm = item;
                        }
                        updateRadioDisplay(cTerminals, selectedCTerm, "radio-c");
                    };
                }
                
                container.appendChild(btn);
            });
        }

        // ID用に文字列をきれいにする (スペースや矢印を除去)
        function cleanId(str) {
            return str.replace(/[^a-zA-Z0-9]/g, '');
        }

        // カウントボタンの表示更新
        function updateButtonDisplay(name, type) {
            const btn = document.getElementById(`btn-${cleanId(name)}`);
            const badge = document.getElementById(`badge-${cleanId(name)}`);
            const count = counts[name];

            if (count > 0) {
                btn.classList.add("selected");
                badge.innerText = count;
            } else {
                btn.classList.remove("selected");
                badge.innerText = 0;
            }
        }

        // ラジオボタン（末端）の表示更新
        function updateRadioDisplay(list, selectedItem, type) {
            list.forEach(item => {
                const btn = document.getElementById(`btn-${cleanId(item.name)}`);
                if (selectedItem && item.name === selectedItem.name) {
                    btn.classList.add("selected");
                } else {
                    btn.classList.remove("selected");
                }
            });
        }

        // --- 計算処理 ---
        function calculate() {
            let totalWeight = 0;

            // N末端
            if (selectedNTerm) totalWeight += selectedNTerm.val;
            // C末端
            if (selectedCTerm) totalWeight += selectedCTerm.val;

            // アミノ酸・修飾の加算
            [...aminoAcids1, ...aminoAcids2, ...specials, ...modifications].forEach(item => {
                const count = counts[item.name] || 0;
                totalWeight += item.val * count;
            });

            // 結果表示（小数点第2位まで、ただし整数に近い場合は適宜）
            // JavaScriptの浮動小数点計算誤差を防ぐため、一度100倍して計算等の厳密な処理は
            // ここでは簡易的に toFixed(2) で対応します。
            
            const mw = parseFloat(totalWeight.toFixed(2));
            
            // +2: (MW + 2.02) / 2
            const plus2 = (mw + 2) / 2;
            
            // +3: (MW + 3.03) / 3
            const plus3 = (mw + 3) / 3;

            // 表示更新
            document.getElementById("res-mw").innerText = mw.toFixed(2);
            document.getElementById("res-plus2").innerText = plus2.toFixed(2);
            document.getElementById("res-plus3").innerText = plus3.toFixed(2);
        }

        // --- クリア処理 ---
        function clearAll() {
            // カウントリセット
            for (let key in counts) {
                counts[key] = 0;
                updateButtonDisplay(key, "count");
            }

            // 末端リセット
            selectedNTerm = null;
            selectedCTerm = null;
            updateRadioDisplay(nTerminals, null, "radio-n");
            updateRadioDisplay(cTerminals, null, "radio-c");

            // 結果リセット
            document.getElementById("res-mw").innerText = "---";
            document.getElementById("res-plus2").innerText = "---";
            document.getElementById("res-plus3").innerText = "---";
        }

        // アプリ起動
        init();

    </script>
</body>
</html>